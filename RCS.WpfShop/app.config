<?xml version="1.0" encoding="utf-8"?>

<!--
Note this file is transformed thanks to an extension.
This also resulted in generated changes in .csproj.
https://marketplace.visualstudio.com/items?itemName=GolanAvraham.ConfigurationTransform
-->

<configuration>
	<!--Note this this needs the first element and only one of this type.-->
	<configSections>
		<section name="unity" type="Microsoft.Practices.Unity.Configuration.UnityConfigurationSection, Unity.Configuration" />
	</configSections>

	<!--TODO Find current location of schema.-->
	<unity xmlns="http://schemas.microsoft.com/practices/2010/unity">
		<assembly name="RCS.WpfShop.AdventureWorks" />
		<container name="Products">
			<register   type="RCS.WpfShop.AdventureWorks.ServiceReferences.IProductsService" mapTo="RCS.WpfShop.AdventureWorks.ServiceReferences.ProductsServiceClient">
				<lifetime type="singleton" />
			</register>
		</container>
	</unity>

	<appSettings>
		<add key="Environment" value="" />
	</appSettings>

	<!--
    maxReceivedMessageSize is arbitrarily increased x 10.
    Note that the retrieved overview table determines the size.
    Pictures in there may be a problem too.
  
    maxArrayLength is arbitrarily increased x 10.
    This seems to be needed for the large pictures in the detail views.
  
    Note there may be a problem with the virtual drive of a project not being mapped.
    Use machine name to be visible in Fiddler.
  
    Note that comments within the serviceModel below get lost when using the configuration editor.
    -->

	<system.serviceModel>
		<diagnostics performanceCounters="Default" />
		<bindings>
			<wsHttpBinding>
				<binding name="ProductsService_wsHttpBinding" maxReceivedMessageSize="655360">
					<readerQuotas maxArrayLength="163840" />
					<security mode="Transport">
						<transport clientCredentialType="None" />
					</security>
				</binding>
			</wsHttpBinding>
		</bindings>

		<client>
			<!-- IIS. 
      Note that everything through IIS is now bound to a certificate for the domain.
      -->
			<endpoint name="ProductsService" address="https://rcsworks.nl/ProductsServicePub/ProductsService.svc/ProductsServiceW" binding="wsHttpBinding" bindingConfiguration="ProductsService_wsHttpBinding" contract="ProductsService.IProductsService" />
		</client>
	</system.serviceModel>

	<system.diagnostics>
		<!--Note this is needed for TextWriterTraceListener.-->
		<trace autoflush="true" />

		<sources>
			<source name="MainTrace" switchName="mainLevel" switchType="System.Diagnostics.SourceSwitch">
				<listeners>
					<!-- Note that a DefaultTraceListener is added. 
               Remove to better control the indiviudal levels.-->
					<remove name="Default"/>

					<!--TODO Maybe remove file of previous session.-->
					<add name="file" type="System.Diagnostics.TextWriterTraceListener" initializeData="RCS.WpfShop.log" traceOutputOptions="DateTime">
						<filter type="System.Diagnostics.EventTypeFilter" initializeData="Verbose"/>
					</add>

					<add name="console" type="System.Diagnostics.ConsoleTraceListener">
						<filter type="System.Diagnostics.EventTypeFilter" initializeData="Warning"/>
					</add>
				</listeners>
			</source>
		</sources>

		<switches>
			<!--For unknown reasons this didn't work for any TraceEventType with lower priority than Verbose.-->
			<add name="mainLevel" value="Verbose"/>
		</switches>
	</system.diagnostics>
</configuration>
